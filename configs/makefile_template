PIP= ${PIP}
VENV_DIR=${VENV_FOLDER}
ENV_FILE= ${ENV_FILE}
CREATE_VIRTUAL_ENV= virtualenv $(VENV_DIR)
ACTIVATE_ENV= . $(VENV_DIR)/bin/activate
REQ= ${PIP_REQS}
ENV_CONFIGS=${ENV_CONFIGS}

install-local:
	source configs/env.sh; rm -rf docker-compose.yml; envsubst < "configs/docker_templates/docker-compose.yml" > "docker-compose.yml";
	source configs/env.sh; rm -rf dev.Dockerfile; envsubst < "configs/docker_templates/dev.Dockerfile" > "dev.Dockerfile";
	source configs/env.sh; rm -rf prod.Dockerfile; envsubst < "configs/docker_templates/prod.Dockerfile" > "prod.Dockerfile";
	source configs/env.sh; rm -rf .dockerignore; envsubst < "configs/docker_templates/.dockerignore" > ".dockerignore";
	rm -rf $(VENV_DIR)/
	rm -f $(ENV_FILE)
	$(CREATE_VIRTUAL_ENV)
	$(ACTIVATE_ENV) && $(PIP) install -r $(REQ) && deactivate
	cp $(ENV_CONFIGS)/local $(ENV_FILE)

package:
	$(ACTIVATE_ENV) && $(PIP) install $(P)
	$(ACTIVATE_ENV) && $(PIP) freeze > $(REQ)
